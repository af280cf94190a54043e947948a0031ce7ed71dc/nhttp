var N=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var re=Object.prototype.hasOwnProperty;var ne=r=>N(r,"__esModule",{value:!0});var se=(r,e)=>{for(var t in e)N(r,t,{get:e[t],enumerable:!0})},ie=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of te(e))!re.call(r,n)&&(t||n!=="default")&&N(r,n,{get:()=>e[n],enumerable:!(s=ee(e,n))||s.enumerable});return r};var oe=(r=>(e,t)=>r&&r.get(e)||(t=ie(ne({}),e,1),r&&r.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var Ee={};se(Ee,{HttpError:()=>h,HttpResponse:()=>j,JsonResponse:()=>D,NHttp:()=>P,RequestEvent:()=>H,Router:()=>T,bodyParser:()=>v,expressMiddleware:()=>Y,getError:()=>E,multipart:()=>U,nhttp:()=>Z});var ae=r=>{try{return decodeURIComponent(r)}catch{return r}};function ue(r,e){if(r=="")return e;r=new RegExp(r);let t=r.flags+e.flags;return t=Array.from(new Set(t.split(""))).join(),new RegExp(r.source+e.source,t)}function ce(r,e,t){let s=t?.groups||{};if(!e||!r)return s;if(r.indexOf("*")!==-1){t.shift();let n=t.filter(o=>o!==void 0).filter(o=>o.startsWith("/")).join("").split("/");n.shift();let i={...s,wild:n.filter(o=>o!=="")};if(r==="*"||r.indexOf("/*")!==-1)return i;let a=r.split("/").find(o=>o.startsWith(":")&&o.endsWith("*"));return a&&(a=a.slice(1,-1),i[a]=[i[a]].concat(i.wild).filter(o=>o!==""),delete i.wild),i}return s}function le(r){let e=r.indexOf("/",1);return e!==-1?r.substring(0,e):r}var T=class{constructor({base:e=""}={}){this.route={};this.c_routes=[];this.midds=[];this.base="";this.base=e,this.base==="/"&&(this.base="")}getRoute(e){let t=this.route[e];if(!!t)return t.m?{fns:t.fns}:(t.fns=this.midds.concat(t.fns),this.route[e]={m:!0,fns:t.fns},{fns:t.fns})}on(e,t,...s){let n;return t instanceof RegExp?n=ue(this.base,t):(t==="/"&&this.base!==""&&(t=""),n=this.base+t),this.c_routes.push({method:e,path:n,fns:s}),this}get(e,...t){return this.on("GET",e,...t)}post(e,...t){return this.on("POST",e,...t)}put(e,...t){return this.on("PUT",e,...t)}patch(e,...t){return this.on("PATCH",e,...t)}delete(e,...t){return this.on("DELETE",e,...t)}any(e,...t){return this.on("ANY",e,...t)}head(e,...t){return this.on("HEAD",e,...t)}options(e,...t){return this.on("OPTIONS",e,...t)}trace(e,...t){return this.on("TRACE",e,...t)}connect(e,...t){return this.on("CONNECT",e,...t)}find(e,t,s,n,i){return this.getRoute(e+t)||(()=>{let a=n(t,t[0]=="/");if(this.route[e+a])return this.getRoute(e+a);if(a[a.length-1]=="/"&&a!="/"){if(i==!0)return{fns:[s]};let f=a.slice(0,-1);if(this.route[e+f])return this.getRoute(e+f)}let o=[],u,c=0,d,l=this.route[e]||[];this.route.ANY&&(l=this.route.ANY.concat(l));let p=l.length;for(;c<p;){if(d=l[c],d?.pathx?.test(a)){o=d.fns,u=()=>ce(d.path,d.wild,d.pathx.exec(ae(a)));break}c++}if(this.pmidds){let f=le(a||"/");this.pmidds[f]&&(o=this.pmidds[f].concat(o))}return o=this.midds.concat(o,[s]),{fns:o,param:u}})()}};var g=new TextEncoder,y=new TextDecoder,k=r=>{try{return decodeURI(r)}catch{return r}},b=r=>{try{return decodeURIComponent(r)}catch{return r}};function S(r){return r.length===3?(t,s)=>{let n=t.response;return t.method=t.request.method,t.__wrapMiddleware||(t.__wrapMiddleware=!0,t.getHeaders=()=>Object.fromEntries(t.request.headers.entries()),n.append=(i,a)=>n.headers.append(i,a),n.setHeader=n.set=n.header,n.getHeader=n.get=i=>n.header(i),n.hasHeader=i=>n.header(i)!==void 0,n.removeHeader=i=>n.headers.delete(i),n.end=n.send,n.writeHead=(i,...a)=>{n.status(i);for(let o=0;o<a.length;o++)typeof a[o]=="object"&&n.header(a[o])},t.respond=({body:i,status:a,headers:o})=>t.respondWith(new Response(i,{status:a,headers:o}))),r(t,n,s)}:r}function R(r){let e=[],t=0,s=r.length;for(;t<s;t++){let n=r[t];Array.isArray(n)?e=e.concat(R(n)):typeof n=="function"&&e.push(S(n))}return e}function A(r){let e={b:1,kb:1024,mb:1048576,gb:1073741824,tb:Math.pow(1024,4),pb:Math.pow(1024,5)};if(typeof r=="number")return r;let t=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i.exec(r),s,n="b";return t?(s=parseFloat(t[1]),n=t[4].toLowerCase()):(s=parseInt(r,10),n="b"),Math.floor(e[n]*s)}function z(r,e){if(r instanceof RegExp)return{pathx:r,wild:!0};if(/\?|\*|\.|\:/.test(r)===!1&&e===!1)return{};let t=!1;return{pathx:new RegExp(`^${r.replace(/\/$/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3").replace(/(\/?)\*/g,(n,i)=>(t=!0,`(${i}.*)?`)).replace(/\.(?=[\w(])/,"\\.")}/*$`),path:r,wild:t}}function J(r,e,t){if(e.length===0)return t;let s=e.shift();s||(r=r||[],Array.isArray(r)&&(s=r.length));let n=+s;isNaN(n)||(r=r||[],s=n),r=r||{};let i=J(r[s],e,t);return r[s]=i,r}function I(r){return r.reduce((t,[s,n])=>{if(t[s])Array.isArray(t[s])?t[s]=[...t[s],n]:t[s]=[t[s],n];else{let[i,a,o]=s.match(/^([^\[]+)((?:\[[^\]]*\])*)/);o&&(o=Array.from(o.matchAll(/\[([^\]]*)\]/g),u=>u[1]),n=J(t[a],o,n)),t[a]=n}return t},{})}function x(r){if(r===null)return{};if(typeof r=="string"){let e=0,t=r.split("&"),s=[],n=t.length;for(;e<n;){let i=t[e].split("=");s.push([k(i[0]),k(i[1]||"")]),e++}return I(s)}return I(Array.from(r.entries()))}function G(r,e){if(r==="")return e;r=new RegExp(r);let t=r.flags+e.flags;return t=Array.from(new Set(t.split(""))).join(),new RegExp(r.source+e.source,t)}function Y(...r){return R(r)}function V(r){return[(e,t)=>(e.url=e.url.substring(r.length)||"/",e.path=e.path.substring(r.length)||"/",t())]}function B(r){return r.substring(r.indexOf("/",8))}function M(r,e,t={}){t.encode=!!t.encode,t.encode&&(e="E:"+btoa(g.encode(e).toString()));let s=`${r}=${e}`;return r.startsWith("__Secure")&&(t.secure=!0),r.startsWith("__Host")&&(t.path="/",t.secure=!0,delete t.domain),t.secure&&(s+="; Secure"),t.httpOnly&&(s+="; HttpOnly"),typeof t.maxAge=="number"&&(s+=`; Max-Age=${t.maxAge}`),t.domain&&(s+=`; Domain=${t.domain}`),t.sameSite&&(s+=`; SameSite=${t.sameSite}`),t.path&&(s+=`; Path=${t.path}`),t.expires&&(s+=`; Expires=${t.expires.toUTCString()}`),t.other&&(s+=`; ${t.other.join("; ")}`),s}function de(r){try{r=r.substring(2);let e=atob(r),t=Uint8Array.from(e.split(",")),s=y.decode(t)||r;if(s!==r&&(s.startsWith("j:{")||s.startsWith("j:["))){let n=s.substring(2);return JSON.parse(b(n))}return b(s)}catch{return b(r)}}function q(r,e,t=0){let s=r.headers.get("Cookie");if(s===null)return{};let n={},i=s.split(";"),a=i.length;for(;t<a;){let[o,...u]=i[t].split("="),c=u.join("=");if(e)n[o.trim()]=c.startsWith("E:")?de(c):b(c);else if(c=b(c),c.startsWith("j:{")||c.startsWith("j:[")){let d=c.substring(2);n[o.trim()]=JSON.parse(d)}else n[o.trim()]=c;t++}return n}var _={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",204:"No Content",206:"Partial Content",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Not Allowed",406:"Not Acceptable",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",421:"Misdirected Request",429:"Too Many Requests",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Temporarily Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",507:"Insufficient Storage"};var h=class extends Error{constructor(e,t,s){super(t);this.message=t||"Http Error",this.status=e||500,this.name=s||"HttpError"}};function E(r,e){let t=r.status||r.statusCode||r.code||500;typeof t!="number"&&(t=500);let s;if(e){let n=r.stack?r.stack.split(`
`):[""];n.shift(),s=n.filter(i=>i.indexOf("file://")!==-1).map(i=>i.trim())}return{status:t,message:r.message||"Something went wrong",name:r.name||"HttpError",stack:s}}var m={contentType:g.encode("Content-Type"),filename:g.encode("filename"),name:g.encode('name="'),dashdash:g.encode("--"),boundaryEqual:g.encode("boundary="),returnNewline2:g.encode(`\r
\r
`),carriageReturn:g.encode("\r")};async function F(r){let e=await r.arrayBuffer(),t=new Uint8Array(e),s=Re(r.headers.get("content-type"));if(!s)return;let n=be(t,s);return fe(n)}function fe(r){let e={fields:{},files:{}};for(let t of r){let{headerByte:s,contentByte:n}=ye(t),i=he(s);if(typeof i=="string"){if(n.byteLength===1&&n[0]===13)continue;e.fields[i]=y.decode(n)}else{let a={name:i.filename,type:i.contentType,size:n.byteLength,lastModified:Date.now()-1e3,arrayBuffer:()=>n};e.files[i.name]instanceof Array?e.files[i.name].push(a):e.files[i.name]?e.files[i.name]=[e.files[i.name],a]:e.files[i.name]=a}}return{...e.fields,...e.files}}function he(r){let e=w(r,m.contentType);return e<0?$(r):pe(r,e)}function pe(r,e){let t={},s=r.slice(0,e-2);t=me(s);let n=r.slice(e+m.contentType.byteLength+2);return t.contentType=y.decode(n),t}function me(r){let e={},t=w(r,m.filename);return t<0?e.name=$(r):e=ge(r,t),e}function ge(r,e){let t=r.slice(0,e-2),s=r.slice(e+m.filename.byteLength+2,r.byteLength-1),n=$(t),i=y.decode(s);return{name:n,filename:i}}function $(r){let e=w(r,m.name),t=r.slice(e+m.name.byteLength,r.byteLength-1);return y.decode(t)}function ye(r){let e=w(r,m.returnNewline2),t=r.slice(0,e),s=r.slice(e+4);return{headerByte:t,contentByte:s}}function be(r,e){let t=K(m.dashdash,e),s=K(t,m.dashdash),n=[];for(;!Te(r,s);){r=r.slice(t.byteLength+2);let i=w(r,t);n.push(r.slice(0,i-2)),r=r.slice(i)}return n}function Re(r){let e=g.encode(r),t=w(e,m.boundaryEqual);if(t>=0)return e.slice(t+m.boundaryEqual.byteLength)}function w(r,e,t=0){if(t>=r.length)return-1;t<0&&(t=Math.max(0,r.length+t));let s=e[0];for(let n=t;n<r.length;n++){if(r[n]!==s)continue;let i=n,a=1,o=n;for(;a<e.length&&(o++,r[o]===e[o-i]);)a++;if(a===e.length)return i}return-1}function Te(r,e){for(let t=0,s=e.length;t<s;t++)if(r[t]!==e[t])return!1;return!0}function K(...r){let e=0;for(let n of r)e+=n.length;let t=new Uint8Array(e),s=0;for(let n of r)t.set(n,s),s+=n.length;return t}var X=class{createBody(e,{parse:t}={}){return t?t(Object.fromEntries(Array.from(e.keys()).map(s=>[s,e.getAll(s).length>1?e.getAll(s):e.get(s)]))):x(e)}isFile(e){return typeof e=="object"&&typeof e.arrayBuffer=="function"}cleanUp(e){for(let t in e)if(Array.isArray(e[t])){let s=e[t];for(let n=0;n<s.length;n++){let i=s[n];if(this.isFile(i)){delete e[t];break}}}else this.isFile(e[t])&&delete e[t]}validate(e,t){let s=0,n=e.length;if(t?.maxCount&&n>t.maxCount)throw new h(400,`${t.name} no more than ${t.maxCount} file`,"BadRequestError");for(;s<n;){let i=e[s],a=i.name.substring(i.name.lastIndexOf(".")+1);if(t?.accept&&!t.accept.includes(a))throw new h(400,`${t.name} only accept ${t.accept}`,"BadRequestError");if(t?.maxSize&&i.size>A(t.maxSize))throw new h(400,`${t.name} to large, maxSize = ${t.maxSize}`,"BadRequestError");s++}}async privUpload(e,t){let s=0,n=e.length;for(;s<n;){let i=e[s];t?.callback&&t.callback(i);let a=t.dest||"";if(a.lastIndexOf("/")===-1&&(a+="/"),a[0]==="/"&&(a=a.substring(1)),!i.filename){let c=Date.now()+i.lastModified.toString()+"_";i.filename=c+i.name}i.path||(i.path=a+i.filename);let o=await i.arrayBuffer(),u=new Uint8Array(o);t.writeFile||(t.writeFile=Deno.writeFile),await t.writeFile(i.path,u),s++}}upload(e){return async(t,s)=>{if(t.body===void 0&&(t.body={}),t.file===void 0&&(t.file={}),t.request.body&&t.request.headers.get("content-type")?.includes("multipart/form-data")){if(t.request.bodyUsed===!1)if(t.request.formData){let n=await t.request.formData();t.body=await this.createBody(n,{parse:t.__parseQuery})}else t.body=await F(t.request)||{};if(Array.isArray(e)){let n=0,i=0,a=e.length;for(;n<a;){let o=e[n];if(o.required&&t.body[o.name]===void 0)throw new h(400,`Field ${o.name} is required`,"BadRequestError");if(t.body[o.name]){t.file[o.name]=t.body[o.name];let u=t.file[o.name],c=Array.isArray(u)?u:[u];this.validate(c,o)}n++}for(;i<a;){let o=e[i];if(t.body[o.name]){t.file[o.name]=t.body[o.name];let u=t.file[o.name],c=Array.isArray(u)?u:[u];await this.privUpload(c,o),delete t.body[o.name]}i++}this.cleanUp(t.body)}else if(typeof e=="object"){let n=e;if(n.required&&t.body[n.name]===void 0)throw new h(400,`Field ${n.name} is required`,"BadRequestError");if(t.body[n.name]){t.file[n.name]=t.body[n.name];let i=t.file[n.name],a=Array.isArray(i)?i:[i];this.validate(a,n),await this.privUpload(a,n),delete t.body[n.name]}this.cleanUp(t.body)}}return s()}}},U=new X;var xe="3mb";async function W(r,e=xe){let t=await r.arrayBuffer();if(e&&t.byteLength>A(e))throw new h(400,`Body is too large. max limit ${e}`,"BadRequestError");return b(y.decode(t))}function C(r,e){let t=r.get("content-type");return t===e||t?.startsWith(e)}function v(r,e,t){return async(n,i)=>{if(n.body||(n.body={}),n.request.body&&n.request.bodyUsed==!1&&typeof r!="boolean"){r==null&&(r={});let a=n.request.headers;if(C(a,"application/json")){if(r.json==!1||r.json==0)return i();try{let o=await W(n.request,r.json);n.body=JSON.parse(o)}catch(o){return i(o)}}else if(C(a,"application/x-www-form-urlencoded")){if(r.urlencoded==!1||r.urlencoded==0)return i();try{let o=await W(n.request,r.urlencoded),u=e||x;n.body=u(o)}catch(o){return i(o)}}else if(C(a,"text/plain")){if(r.raw===!1||r.raw===0)return i();try{let o=await W(n.request,r.raw);try{n.body=JSON.parse(o)}catch{n.body={_raw:o}}}catch(o){return i(o)}}else if(C(a,"multipart/form-data")){if(r.multipart==!1||r.multipart==0)return i();try{if(n.request.formData){let o=await n.request.formData();n.body=await U.createBody(o,{parse:t})}else n.body=await F(n.request)||{}}catch(o){return i(o)}}}return i()}}var O="application/json; charset=UTF-8",j=class{constructor(e){this.resp=e}header(e,t){if(this.init||(this.init={}),this.init.headers?this.init.headers instanceof Headers&&(this.init.headers=Object.fromEntries(this.init.headers.entries())):this.init.headers={},typeof e=="string")return e=e.toLowerCase(),t?(this.init.headers[e]=t,this):this.init.headers[e];if(typeof e=="object"){e instanceof Headers&&(e=Object.fromEntries(e.entries()));for(let s in e)this.init.headers[s.toLowerCase()]=e[s];return this}return this.init.headers=new Headers(this.init.headers)}get headers(){return this.init||(this.init={}),this.init.headers instanceof Headers?this.init.headers:this.init.headers=new Headers(this.init.headers)}set headers(e){this.init||(this.init={}),this.init.headers=e}status(e){return this.init||(this.init={}),e?(this.init.status=e,this):this.init.status||200}sendStatus(e){return this.status(e),this.resp(new Response(_[this.status()],this.init))}get statusCode(){return this.status()}set statusCode(e){this.status(e)}type(e){return this.header("content-type",e),this}send(e){return typeof e=="object"?e instanceof Response?e:e instanceof Uint8Array||e instanceof ReadableStream||e instanceof FormData||e instanceof Blob||typeof e.read=="function"?this.resp(new Response(e,this.init)):this.json(e):this.resp(new Response(e,this.init))}json(e){return this.init||(this.init={}),this.init.headers?this.type(O):this.init.headers={"content-type":O},this.resp(new Response(JSON.stringify(e),this.init))}redirect(e,t){return this.header("Location",e).status(t||302).send()}cookie(e,t,s={}){return s.httpOnly=s.httpOnly!==!1,s.path=s.path||"/",s.maxAge&&(s.expires=new Date(Date.now()+s.maxAge),s.maxAge/=1e3),t=typeof t=="object"?"j:"+JSON.stringify(t):String(t),this.headers.append("Set-Cookie",M(e,t,s)),this}clearCookie(e,t={}){t.httpOnly=t.httpOnly!==!1,this.headers.append("Set-Cookie",M(e,"",{...t,expires:new Date(0)}))}},D=class extends Response{constructor(e,t={}){t.headers?t.headers instanceof Headers?t.headers.set("content-type",O):t.headers["content-type"]=O:t.headers={"content-type":O};super(JSON.stringify(e),t)}};var H=class{constructor(e){this.request=e}get response(){return this.res||(this.res=new j(this.respondWith))}get responseInit(){let e=this.res?.init||{},t=e.status||200,s=e.headers instanceof Headers?e.headers:new Headers(e.headers||{}),n=_[t];return{headers:s,status:t,statusText:n}}get file(){return this._file||(this._file={})}set file(e){this._file=e}get cookies(){return this._cookies||(this._cookies=q(this.request,!0))}set cookies(e){this._cookies=e}get params(){return this._params||(this._params=this.__params?.()||{})}set params(e){this._params=e}get body(){return this._body||(this._body={})}set body(e){this._body=e}get url(){return this._url||(this._url=B(this.request.url))}set url(e){this._url=e}get originalUrl(){return B(this.request.url)}get path(){return this._path||this.url}set path(e){this._path=e}get query(){return this._query||(this._query={})}set query(e){this._query=e}};var L=(r,e,t)=>{let s=E(r,t);return e.response.status(s.status).json(s)},we=()=>new Promise(r=>setTimeout(r)),P=class extends T{constructor({parseQuery:e,bodyParser:t,env:s,flash:n,stackError:i,strictUrl:a}={}){super();this.parseQuery=e||x,this.multipartParseQuery=e,this.bodyParser=t,this.strictUrl=a,this.stackError=i!==!1,this.env=s||"development",this.env!=="development"&&(this.stackError=!1),this.flash=n,this.handleEvent=(o,...u)=>this.handleRequest(o.request,()=>u),this.handle=(o,...u)=>this.handleRequest(o,()=>u),e&&this.use((o,u)=>(o.__parseQuery=e,u()))}onError(e){return this._onError=(t,s,n)=>{s.__onErr=!0;let i=t.status||t.statusCode||t.code||500;return typeof i!="number"&&(i=500),s.response.status(i),e(t,s,n)},this}on404(e){return this._on404=(t,s)=>(t.response.status(404),e(t,s)),this}use(e,...t){let s=t,n="";if(typeof e=="function"&&s.length===0)return this.midds=this.midds.concat(S(e)),this;typeof e=="string"?n=e==="/"?"":e:s=[e].concat(s);let i=s[s.length-1];return typeof i=="object"&&(i.c_routes||i[0].c_routes)?this.pushRoutes(n,R(s),i):n!==""?(this.pmidds=this.pmidds||{},this.pmidds[n]=V(n).concat(R(s))):this.midds=this.midds.concat(R(s)),this}on(e,t,...s){let n=R(s),{path:i,pathx:a,wild:o}=z(t,e==="ANY");return a?(this.route[e]=this.route[e]||[],this.route[e].push({path:i,pathx:a,fns:n,wild:o})):this.route[e+t]={fns:n},this}handleRequest(e,t){let s=0,n,i=new H(e);i.info=t;let a=e.method,o=e.url;this.lenn==null&&(this.lenn=o.indexOf("/",8));let{fns:u,param:c}=this.find(a,o.substring(this.lenn),this._on404,(l,p)=>{p||(this.lenn=o.indexOf("/",8),l=o.substring(this.lenn));let f=l.indexOf("?");if(f!=-1){let Q=l.substring(0,f);return i.path=Q,i.query=this.parseQuery(l.substring(f+1)),i.search=l.substring(f),Q}return l},this.strictUrl);c&&(i.__params=c),i.respondWith=l=>(n=()=>l,l),i.getCookies=l=>q(e,l);let d=l=>{try{let p=l?this._onError(l,i,d):u[s++](i,d);return typeof p=="string"?i.respondWith(new Response(p,i.res?.init)):p instanceof Response?p:(async()=>{try{let f=await p;return f?i.response.send(f):n?n():(await we(),n?.())}catch(f){return l?L(f,i,this.stackError):d(f)}})()}catch(p){return l?L(p,i,this.stackError):d(p)}};return a=="GET"||a=="HEAD"?d():v(this.bodyParser,this.parseQuery,this.multipartParseQuery)(i,d)}async listen(e,t){let s=!1,n=this.handle;typeof e=="number"?e={port:e}:typeof e=="object"&&(s=e.certFile!==void 0||e.cert!==void 0||e.alpnProtocols!==void 0,n=e.handler||n);let i=a=>{if(t){let o=e;return t(a,{...o,hostname:o.hostname||"localhost"}),!0}};if(e.test){i();return}try{if(this.flash){if(Deno.serve==null){console.log(new TypeError("flash server is unstable. please add --unstable flag"));return}i()&&(e.onListen=()=>{}),await Deno.serve(e,this.handle)}else for(this.server=(s?Deno.listenTls:Deno.listen)(e),i();;)try{let a=await this.server.accept();if(a)this.handleConn(a,n);else break}catch{}}catch(a){i(a)}}pushRoutes(e,t,s){s=Array.isArray(s)?s:[s],s.forEach(n=>{n.c_routes.forEach(i=>{let{method:a,path:o,fns:u}=i,c;if(o instanceof RegExp)c=G(e,o);else{let d=o;d==="/"&&e!==""&&(d=""),c=e+d}this.on(a,c,[t,u])})})}_onError(e,t,s){return L(e,t,this.stackError)}_on404(e,t){let s=E(new h(404,`Route ${e.request.method}${e.url} not found`,"NotFoundError"));return e.response.status(s.status).json(s)}async handleConn(e,t){try{let s=Deno.serveHttp(e);for(;;)try{let n=await s.nextRequest();if(n)await n.respondWith(t(n.request,e));else break}catch{break}}catch{}}};function Z(r={}){return new P(r)}module.exports=oe(Ee);0&&(module.exports={HttpError,HttpResponse,JsonResponse,NHttp,RequestEvent,Router,bodyParser,expressMiddleware,getError,multipart,nhttp});
